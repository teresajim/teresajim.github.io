<!DOCTYPE html>
<html>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3pro.css">

  <head>
    <base target="_top">
  </head>


  <body onload="initialShowQuestionsToAnswer()">

    <p id = "CurrentPage" hidden></p>
    
    <table style="width:90%">
      <tr>
	<td> &nbsp; &nbsp; &nbsp; </td>
	<td align=left>
	  <h3>
	    Welcome!  Your seating code is <label id="introLabel"> [Unknown] </label> <br>

	    To find your table, answer one of the following questions from this <a href = https://sites.google.com/view/teresaandjim/quiz-questions>quiz</a>. <br><br>

	    <input type="text" name="lookupQuestionList" id="lookupQuestionList">
	    <button onclick="buttonShowQuestionsToAnswer()">Lookup Questions</button>  <br> <br>

	    <b>Questions</b>: <label id="lblSeatingCode"> [Press button to lookup question list] </label>  <br>

            <table>

	      <tr id = "prob1" style="display: table-row;">
		<td valign="top"> 1. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>

	      <tr id = "prob2" style="display: table-row;">
		<td valign="top"> 2. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>

	      <tr id = "prob3" style="display: table-row;">
		<td valign="top"> 3. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>


	      <tr id = "prob4" style="display: table-row;">
		<td valign="top"> 4. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>

	      <tr id = "prob5" style="display: table-row;">
		<td valign="top"> 5. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>
	      
	      <tr id = "prob6" style="display: table-row;">
		<td valign="top"> 6. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>
	      
	      <tr id = "prob7" style="display: table-row;">
		<td valign="top"> 7. &nbsp; &nbsp;</td>
		<td> Jim has programmed an observer drone to fly back and forth to gather information on the movements of the nearby Terran garrison.   It turns out that the farthest distance that his observer traveled from his home base is given by the expression

		  <p align=center>
                    <img src="images/prob7Telescope.svg">		    
		  </p>
		  What is the value of <i>d</i>?
		</td>
	      </tr>


	      <tr id = "prob8" style="display: table-row;">	      
		<td valign="top"> 8. &nbsp; &nbsp;</td>
		<td>
                  The following equation has two solutions for the value of <i>x</i>.  
		  <p align=center>
                    <img src="images/prob8QuadEqn.png">		    
		  </p>
                  What is the larger of the two solutions?		  
		</td>
	      </tr>

	      <tr id = "prob9" style="display: table-row;">
		<td valign="top"> 9. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>

	      <tr id = "prob10" style="display: table-row;">
		<td valign="top"> 10. &nbsp; &nbsp;</td>
		<td> INSERT_QUESTION
		  <p align=center>
		     INSERT IMAGE IF NEEDED
		  </p>
		</td>
	      </tr>
	      
       </table>
            <br>
            Submit your answers on this <a href = https://sites.google.com/view/teresaandjim/table-finder/>table finder form</a>!
           </br>
       </h3>
       </td>
</tr>
</table>



<script>
  function showQuestionsToAnswer(updateQuestions) {
      let code = document.getElementById('lookupQuestionList').value;
      if ((code != null) && (code != "")) { 
	  code = code.toUpperCase();
	  let introLabel = document.getElementById('introLabel');
	  introLabel.innerText = code;
	  let questionList = lookupQuestionsFromSeatingCode(code);
	  let lbl = document.getElementById('lblSeatingCode');
	  lbl.innerText = questionList;

	  refreshTableRowsBeingShown(code);
      } else {
	  let introLabel = document.getElementById('introLabel');
	  introLabel.innerText = "[Unknown]";
      }
  }

  function refreshTableRowsBeingShown(code) {
      var lookupObj = codeToQuestionMap.get(code)
      var qList = null;
      if (lookupObj != null) {
	  var qListTmp = codeToQuestionMap.get(code)
	  if (qListTmp != null) {
	      qList = qListTmp.questions;
	  }
      }
      for (let qnum = 1; qnum <= 30; qnum++) {
	  let probString = "prob" + qnum;
	  let probInfo = document.getElementById(probString);
	  if (probInfo == null) {
	      continue;
	  }
	  if (qList == null) {
	      probInfo.style = "display: table-row";
	  } else if (qList.includes(qnum)) {
	      probInfo.style = "display: table-row";	      
	  } else {
	      probInfo.style = "display: none";	      
	  }
      }
  }
  
  function initialShowQuestionsToAnswer() {
      let code = extractSeatingCodeFromCurrentPageUrl();
      if (code != null) {
	  code = code.toUpperCase();
	  let questionListBlock = document.getElementById('lookupQuestionList');
	  document.getElementById('lookupQuestionList').value = code;
	  showQuestionsToAnswer(true);
      }
  }

  function buttonShowQuestionsToAnswer() {
      showQuestionsToAnswer(true);
  }

  function lookupQuestionsFromSeatingCode(code) {
      if ((code.length > 0) && codeToQuestionMap.has(code)) {
          var qList = codeToQuestionMap.get(code).questions;
          return " " + formatQuestionList(qList);
      } else {
          return "Unknown code [" + code + "].  Please enter a valid code.";
      }
  }

  function questionMatchesForCode(code, qnum) {
      if ((code.length > 0) && codeToQuestionMap.has(code)) {
//	  alert("qnum is " + qnum);
//          var qList = codeToQuestionMap.get(code).questions;
//	  alert("Testing code is " + code + ", qlist is " + qList);	  
	  //	  return qList.includes(qnum);
	  return false;
      } else {
//	  alert("No match...");
	  return true;	  
      }
  }
  

  // Pretty-print the question list.
  function formatQuestionList(qlist) {
      var questionString = "Answer one of ";
      L = qlist.length;
      for (var i = 0; i < L-1; i++) {
          questionString = questionString + "#" + qlist[i] + ", ";
      }
      questionString = questionString + "or #" + qlist[L-1] + ".";
      return questionString;
  }

  const codeToQuestionMap = new Map([
      ["BBY", { "questions" : [2,  5,  7]}],
      ["BGB", { "questions" : [10,  14,  19]}],
      ["BHG", { "questions" : [2,  5,  9]}],
      ["BJF", { "questions" : [4,  10,  13]}],
      ["CML", { "questions" : [2,  8,  13]}],
      ["CTM", { "questions" : [1,  3,  9]}],
      ["CVS", { "questions" : [4,  10,  18]}],
      ["CWM", { "questions" : [4,  11,  14]}],
      ["DCL", { "questions" : [1,  4,  12]}],
      ["DGN", { "questions" : [6,  12,  16]}],
      ["DGW", { "questions" : [5,  7,  14]}],
      ["DSN", { "questions" : [2,  5,  7]}],
      ["FNG", { "questions" : [4,  5,  11]}],
      ["GDC", { "questions" : [4,  5,  7]}],
      ["GNV", { "questions" : [12,  15,  24]}],
      ["HBZ", { "questions" : [5,  9,  17]}],
      ["HPB", { "questions" : [6,  9,  13]}],
      ["HVC", { "questions" : [1,  3,  9]}],
      ["JBH", { "questions" : [3,  6,  12]}],
      ["JDP", { "questions" : [7,  10,  16]}],
      ["JDW", { "questions" : [4,  5,  11]}],
      ["JNR", { "questions" : [3,  4,  10]}],
      ["LCB", { "questions" : [1,  3,  10]}],
      ["LHN", { "questions" : [18,  23,  26]}],
      ["LNL", { "questions" : [4,  9,  13]}],
      ["LPV", { "questions" : [13,  17,  20]}],
      ["MFG", { "questions" : [2,  5,  7]}],
      ["MMJ", { "questions" : [1,  2,  4]}],
      ["MPM", { "questions" : [1,  7,  15]}],
      ["MQD", { "questions" : [2,  5,  10]}],
      ["NHW", { "questions" : [6,  9,  13]}],
      ["NLJ", { "questions" : [5,  9,  10]}],
      ["NRB", { "questions" : [1,  4,  12]}],
      ["PSL", { "questions" : [4,  5,  11]}],
      ["QNV", { "questions" : [2,  6,  8]}],
      ["QVW", { "questions" : [1,  3,  9]}],
      ["RLH", { "questions" : [1,  6,  12]}],
      ["RQP", { "questions" : [1,  3,  9]}],
      ["RRQ", { "questions" : [1,  3,  9]}],
      ["SJH", { "questions" : [2,  6,  8]}],
      ["SVJ", { "questions" : [7,  16,  19]}],
      ["TFM", { "questions" : [2,  6,  8]}],
      ["TMY", { "questions" : [1,  3,  9]}],
      ["TYC", { "questions" : [1,  3,  9]}],
      ["VFV", { "questions" : [1,  3,  10]}],
      ["VWJ", { "questions" : [4,  11,  15]}],
      ["WJB", { "questions" : [4,  5,  11]}],
      ["WLB", { "questions" : [1,  4,  12]}],
      ["WRL", { "questions" : [3,  5,  12]}],
      ["YJN", { "questions" : [6,  9,  17]}],
      ["YMP", { "questions" : [4,  9,  14]}],
      ["YNS", { "questions" : [4,  12,  16]}],
      ["YVV", { "questions" : [4,  10,  14]}],
      ["ZDZ", { "questions" : [1,  3,  9]}],
      ["ZHD", { "questions" : [2,  4,  7]}],
      ["ZMR", { "questions" : [1,  3,  9]}],
      ["ZWS", { "questions" : [1,  3,  9]}],
  ])

  
  function extractSeatingCodeFromCurrentPageUrl() {
      let currentUrl =  document.getElementById("CurrentPage").innerHTML = window.location.href;
      return extractSeatingCodeFromUrl(currentUrl);
  }

  function extractSeatingCodeFromUrl(url) {
      var event = getAllUrlParams(url);
      if (typeof event === "undefined") {
	  return null;
      }

      if ("seatingcode" in event) {
	  return event["seatingcode"];
      } else {
	  return null;
      }
  }

  function getAllUrlParams(url) {
      // get query string from url (optional) or window
      var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

      // we'll store the parameters here
      var obj = {};

      // if query string exists
      if (queryString) {

	  // stuff after # is not part of query string, so get rid of it
	  queryString = queryString.split('#')[0];

	  // split our query string into its component parts
	  var arr = queryString.split('&');

	  for (var i = 0; i < arr.length; i++) {
	      // separate the keys and the values
	      var a = arr[i].split('=');

	      // set parameter name and value (use 'true' if empty)
	      var paramName = a[0];
	      var paramValue = typeof (a[1]) === 'undefined' ? true : a[1];

	      // (optional) keep case consistent
	      paramName = paramName.toLowerCase();
	      if (typeof paramValue === 'string') paramValue = paramValue.toLowerCase();

	      // if the paramName ends with square brackets, e.g. colors[] or colors[2]
	      if (paramName.match(/\[(\d+)?\]$/)) {

		  // create key if it doesn't exist
		  var key = paramName.replace(/\[(\d+)?\]/, '');
		  if (!obj[key]) obj[key] = [];

		  // if it's an indexed array e.g. colors[2]
		  if (paramName.match(/\[\d+\]$/)) {
		      // get the index value and add the entry at the appropriate position
		      var index = /\[(\d+)\]/.exec(paramName)[1];
		      obj[key][index] = paramValue;
		  } else {
		      // otherwise add the value to the end of the array
		      obj[key].push(paramValue);
		  }
	      } else {
		  // we're dealing with a string
		  if (!obj[paramName]) {
		      // if it doesn't exist, create property
		      obj[paramName] = paramValue;
		  } else if (obj[paramName] && typeof obj[paramName] === 'string'){
		      // if property does exist and it's a string, convert it to an array
		      obj[paramName] = [obj[paramName]];
		      obj[paramName].push(paramValue);
		  } else {
		      // otherwise add the property
		      obj[paramName].push(paramValue);
		  }
	      }
	  }
      }

      return obj;
  }


  
  // // Parse the URL parameter
  // function getParameterByName(name, url) {
  //     if (!url) url = window.location.href;
  //     name = name.replace(/[\[\]]/g, "\\$&");
  //     var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
  // 	  results = regex.exec(url);
  //     if (!results) return null;
  //     if (!results[2]) return '';
  //     return decodeURIComponent(results[2].replace(/\+/g, " "));
  // }

  
  // Give the parameter a variable name
  // var seatingCodeForQuestionList = extractSeatingCodeFromCurrentPageUrl();
  
</script>


</body>
</html>
